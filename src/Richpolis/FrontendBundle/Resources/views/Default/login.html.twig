{% extends 'FrontendBundle::layout.html.twig' %}

   
{% block contenido %}
    <div id="fb-root"></div>
    <div class="row">
        {% if error %}
            <div class="col-xs-4 col-xs-offset-2 col-md-6 col-md-offset-2">{{ error.message | trans }}</div>
        {% endif %}
        {% for flashMessage in app.session.flashbag.get('notice') %}
            <div class="col-xs-4 col-xs-offset-2 col-md-6 col-md-offset-2 flash-notice alert alert-success">
              {{ flashMessage }}
            </div>
        {% endfor %}
        {% for flashMessage in app.session.flashbag.get('error') %}
            <div class="col-xs-4 col-xs-offset-2 col-md-6 col-md-offset-2 flash-notice alert alert-danger">
              {{ flashMessage }}
            </div>
        {% endfor %}
        <div class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
            <form action="{{ path('login_check') }}" method="post" class="form-signin">
                <h2 class="form-signin-heading">
                    Login <br/>
                    <span class="form-signin-subheading">Ya tienes cuenta?</span>
                </h2>
                <input id="username" type="text" name="_username" value="{{ last_username }}" class="form-control" placeholder="Usuario" required autofocus>
                <input id="password" type="password" name="_password" class="form-control" placeholder="Password" required>
                <label class="checkbox remember-me">
                    <input type="checkbox" id="remember_me" name="_remember_me"> Recordar
                </label>
                <button class="btn btn-block btn-lg btn-danger" type="submit">Entrar</button>
            </form>
        </div>    
    </div>    
    <p>&nbsp;</p>
    <div class="row text-center ">
        <div class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4 ">
            <a href="{{ path('recuperar')}}" class="without-underline">No puede iniciar...haga click aqui &nbsp; <span class="glyphicon glyphicon-envelope"></span></a>
        </div>
    </div>
    <p>&nbsp;</p>
    <div class="row text-center">
        <p class="text-left padding-izquierdo col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4 ">O puedes logearte con:</p>
        <p class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
            <a href="#" onclick="loginFacebook()"/><span class="redes-sociales facebook">&nbsp;</span></a>
            <a href="#" ><span class="redes-sociales twitter">&nbsp;</span></a>
            <a href="#" ><span class="redes-sociales googleplus">&nbsp;</span></a>
        </p>
        <br/>
        <p class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4 ">
            <a href="{{path('registro')}}"> no tienes cuenta? Registro</a>
        </p>
    </div>
{% endblock %}

{% block javascripts %}
{{ parent() }}

<script>
    $(document).ready(function(){
        setTimeout(function(){
            $(".alert").fadeOut('slow');
        },2000);
    });
</script>

<!-- CARGA DE SIMPLE FACEBOOK GRAPH -->
<script src="{{asset('js/simpleFacebookGraph.js')}}"></script>

<!-- SCRIPTS PROPIOS QUE USA ESTA PÁGINA -->
<script>

// Cuando la pagina carga miramos si ya hay un usuario identificado.
fb.ready(function(){ 
  if (fb.logged)
  {
    // Cambiamos el link de identificarse por el nombre y la foto del usuario.
    html = "<p>Hola " + fb.user.name + "</p>";
    html += '<p><img src="' + fb.user.picture + '"/></p>';
    html += '<p><a href="#" onclick="fb.logout(); return false;">Salir</a></p>';
    document.getElementById("conectar_facebook").innerHTML = html;
  }
});


// Funcion para logarse con Facebook.
function loginFacebook() {
  fb.login(function(){ 
    if (fb.logged) {
      console.log(fb.user);
      // Cambiamos el link de identificarse por el nombre y la foto del usuario.
      html = "<p>Hola " + fb.user.name + "</p>";
      html += "<p><img src='" + fb.user.picture + "'/></p>";
      document.getElementById("conectar_facebook").innerHTML = html;
    } else {
      alert("No se pudo identificar al usuario");
    }
  })
};

// Funcion para publicar un mensaje en tu muro
var publish = function () {
    fb.publish({
      message : "Estoy probando un script para que la gente publique desde mi/s web/s en Facebook",
      picture : "http://blog.ikhuerta.com/wp-content/themes/ikhuerta3/images/ikhuerta.jpg",
      link : "http://blog.ikhuerta.com/simple-facebook-graph-javascript-sdk",
      name : "Simple Facebook Graph Javascript SDK",
      description : "Facebook Graph es una nueva forma de conectar tu web Facebook. Con este script es muy fácil conseguirlo :)"
    },function(published){ 
      if (published)
       alert("publicado!");
      else
       alert("No publicado :(, seguramente porque no estas identificado o no diste permisos");
    });  
}
</script>

{% endblock %}    